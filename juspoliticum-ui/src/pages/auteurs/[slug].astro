---
import Layout from "../../layouts/Layout.astro";
import PageLayout from "../../layouts/PageLayout.astro";
import ArticleTitle from "../../components/ArticleTitle.astro";

import { getDirectusClient } from "../../utils/get-directus-client";
import { readItems } from "@directus/sdk";

export async function getStaticPaths() {
  const directus = await getDirectusClient();
  const authors = await directus.request(
    readItems("Authors", {
      fields: [
        "id",
        "slug",
        "fullname",
        "articles.article_id.title",
        "articles.article_id.slug",
        "articles.article_id.section_id.volume_id.title",
        "articles.article_id.section_id.volume_id.slug",
        "articles.article_id.authors.author_id.fullname",
        "articles.article_id.authors.author_id.slug",
        "articles.article_id.abstracts.*",
      ],
      limit: 1000,
      sort: ["-id"],
      filter: {
        site_id: {
          _eq: "2",
        },
      },
    }),
  );
  return authors.map((author) => ({
    params: { slug: author.slug },
    props: { author },
  }));
}

const { author } = Astro.props;
---

<Layout title="Droit & Philosophie.">
  <PageLayout title={`Les articles de l'auteur : ${author.fullname}`}>
    <ul>
      {
        author.articles.map((article) => (
          <li>
            <ArticleTitle article={article.article_id} />
          </li>
        ))
      }
    </ul>
    <script src="/js/dynamic-article-list.js" type:"text javascript"></script>
  </PageLayout>
</Layout>
