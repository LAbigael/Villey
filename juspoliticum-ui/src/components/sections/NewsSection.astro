---
import Actu from "../Actu.astro";
import Volume from "../Volume.astro";

import { getDirectusClient } from "../../utils/get-directus-client";
import { readItems, readItem } from "@directus/sdk";
import { Debug } from "astro:components";

const directus = await getDirectusClient();

const volumes = await directus.request(
  readItems("Volumes", {
    fields: ["id", "slug", "title", "coordinators", "number", "published_at"],
    sort: ["-id"],
    limit: 4,
    filter: {
      site_id: {
        _eq: "2",
      },
    },
  }),
);

let latestVolume = volumes.shift();

latestVolume = await directus.request(
  readItem("Volumes", latestVolume.id, {
    fields: [
      "slug",
      "title",
      "subtitle",
      "number",
      "published_at",
      {
        sections: [
          "title",
          {
            articles: [
              "title",
              "slug",
              { authors: ["author_id.fullname"] },
              "subtitle",
              { abstracts: ["language", "content_bis"] },
            ],
          },
        ],
      },
    ],
  }),
);
---

<div class="py-4 lg:py-6">
  <div class="md:mx-12 sm:p-5">
    <!-- text - start -->
    <div class="mb-10 md:mb-16">
      <h2 class="mb-4 text-center text-2xl font-bold md:mb-6 lg:text-3xl">
        À la une
      </h2>
      <div class="mx-auto max-w-screen-lg text-center">
        <p class="text-gray-500 mb-6 md:text-lg">
          Le dernier numéro publié sur Juspoliticum
        </p>
        <Volume volume={latestVolume} />
      </div>
      <p
        class="mx-auto max-w-screen-md text-center text-gray-500 mb-6 md:text-lg"
      >
        Les anciens numéros
      </p>
      <div class="flex flex-wrap max-w-screen-lg mx-auto justify-center">
        {
          volumes.map((volume) => (
            <div class="w-full lg:w-1/2 p-2">
              {" "}
              <Actu volume={volume} />{" "}
            </div>
          ))
        }
      </div>
    </div>
    <!-- text - end -->
  </div>
</div>
