---
import Layout from "../../layouts/Layout.astro";
import { getDirectusClient } from "../../utils/get-directus-client.js";
import { readItems } from "@directus/sdk";
import { Debug } from "astro:components";

const directus = await getDirectusClient();
const authors = await directus.request(
  readItems("Authors", {
    fields: [
      "fullname",
      "bio",
      "articles.article_id.title",
      "articles.article_id.slug",
      "articles.article_id.section_id.volume_id.title",
      "articles.article_id.section_id.volume_id.slug",
    ],
    sort: ["fullname"],
    filter: {
      site_id: {
        _eq: "1",
      },
    },
  }),
);
---

<Layout title="Droit & Philosophie.">
  <main class="font-light flex flex-row max-w-screen-lg">
    <div class="w-1/4">side</div>
    <div class="w-3/4">
      <h3 class="page_title">Auteurs de la revue</h3>
      {
        authors.map((author) => (
          <div class="mb-8 author_section">
            <h4 class="text-2xl italic font-bold">{author.fullname}</h4>
            <div class="text-lg my-6" set:html={author.bio} />
            <span class="pr-4 my-4 font-semibold text-xl">
              Ses articles pour Droit & Philosophie :{" "}
            </span>
            <ul class="ml-6 list-disc list-inside">
              {author.articles.map((article) => (
                <li>
                  {article.article_id.section_id?.volume_id?.title && (
                    <a
                      class="volume_title"
                      href={`/volumes/${article.article_id.section_id.volume_id.slug}`}
                    >
                      {article.article_id.section_id.volume_id.title}
                    </a>
                  )}
                  {" "}:{" "}
                  <a href={`/articles/${article.article_id.slug}`}>
                    {article.article_id.title}
                  </a>
                </li>
              ))}
            </ul>
          </div>
        ))
      }
    </div>
    <style>
      main {
        margin: auto;
      }
    </style>
  </main>
</Layout>

<style>
  .author_section {
    @apply my-8 pb-4 border-b;
    border-bottom-width: 1px;
    border-color: rgba(var(--secondary));
  }
  .volume_title {
    @apply text-lg;
    color: rgba(var(--secondary));
  }
</style>
